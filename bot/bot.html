<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo chat bot</title>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <!-- <link rel="stylesheet" href="https://bootswatch.com/5/sketchy/bootstrap.min.css"> -->
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <style>
        .bot-message {
            background-color: #f5f5f5;
        }

        .user-message {
            background-color: #e9e9e9;
        }

        .message {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .fixed-bottom {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #f5f5f5;
            padding: 10px;
            text-align: center;
        }
    </style>
</head>

<body>

    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Chat bot</h3>
                    </div>
                    <div class="panel-body">
                        <div id="chat-area">

                        </div>
                        <div class="input-group">
                            <input type="text" class="form-control" id="user-input"
                                placeholder="Type your message here..." aria-describedby="basic-addon2">
                            <span class="input-group-btn">
                                <button class="btn btn-default" type="button" id="send-btn">Send</button>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="fixed-bottom">
        <div class="version">Version: 1.0</div>
    </div>
    <script>
        const chatArea = document.getElementById('chat-area');
        const sendBtn = document.getElementById('send-btn');
        const userInput = document.getElementById('user-input');
        const history = [];

        sendBtn.addEventListener('click', () => {
            const message = userInput.value;
            if (message.trim() !== '') {
                const messageElement = document.createElement('div');
                messageElement.classList.add('message');
                messageElement.classList.add('user-message');
                messageElement.textContent = "You: " + message;
                chatArea.appendChild(messageElement);
                userInput.value = '';
                chatArea.scrollTop = chatArea.scrollHeight;

                //bot reply
                botReply([message], history, (data) => {
                    const botMessage = document.createElement('div');
                    botMessage.classList.add('message');
                    botMessage.classList.add('bot-message');
                    botMessage.textContent = "Bot: " + data.choices[0].message.content;
                    chatArea.appendChild(botMessage);
                    chatArea.scrollTop = chatArea.scrollHeight;
                    history.push([message, data.choices[0].message.content]);
                });
            }
        });

        userInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                sendBtn.click();
            }
        });

        /**
         * Send a message to the chat bot and get a response.
         * @param {string[]} messages - The message to send to the bot.
         * @param {string[][]} history - The history of messages sent to the bot.
         * @param {function(data: {choices: {message: {content: string}}[]})} callback - The callback function to call with the bot's response.
         */
        function botReply(messages, history, callback) {
            const API_AUTH = "Bearer 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";
            const API_URL = "https://api-inference.huggingface.co/models/microsoft/Phi-3.5-mini-instruct/v1/chat/completions";
            const headers = {
                "Authorization": API_AUTH,
                "Content-Type": "application/json"
            };
            const data = {
                "messages": [
                    {
                        "role": "user",
                        "content": messages[0]
                    }
                ],
                "history": history,
                "model": "microsoft/Phi-3.5-mini-instruct",
                "max_tokens": 200,
                "stream": false
            };
            fetch(API_URL, {
                method: "POST",
                headers: headers,
                body: JSON.stringify(data)
            })
                .then(response => response.json())
                .then(data => {
                    callback(data);
                })
                .catch(error => {
                    console.error("Error:", error);
                });
        }

    </script>
</body>

</html>